version: v1
name: foobar2
inputs:
  - name: file_contents
    description: File contents to read and write
    type: text
    default: "foobar"
  - name: message_contents
    description: Message contents to write
    type: password
    default: "hello world"
links:
  website: https://johnfcarter.tech
  google: https://google.com
tasks:
- name: write_file
  image: ubuntu:20.04
  run: |
    echo "${file_contents}" > /tmp/run/foobar2.txt
  store:
    file:
      - foobar2.txt
  inputs:
    file_contents: file_contents
- name: store_env_var
  image: ubuntu:20.04 
  run: |
    MESSAGE="${message_contents}"
  store:
    env:
      - MESSAGE
  inputs:
    message_contents: message_contents
- name: print_file_and_env
  depends_on:
    - write_file
    - store_env_var
  image: ubuntu:20.04
  load:
    env:
      - MESSAGE
    file:
      - foobar2.txt
  run: |
    ls /tmp/run
    cat /tmp/run/foobar2.txt
    echo "${MESSAGE}"
  check:
    interval: 10
    image: ubuntu:20.04
    load:
      env:
        - MESSAGE
    run: |
      echo "Running check"
      sleep 1
      echo "message is ${MESSAGE}"
